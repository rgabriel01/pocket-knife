# Story 1.1: Project Setup and Infrastructure

## Status

**In Progress**

## Story

**As a** developer,  
**I want** the project repository and development environment configured,  
**so that** I can begin implementing features with proper tooling in place.

## Acceptance Criteria

1. Git repository is initialized with appropriate `.gitignore` for Ruby projects
2. Project has standard Ruby structure (`bin/`, `lib/`, `spec/` directories)
3. `Gemfile` exists with development dependencies (RSpec, RuboCop)
4. `Rakefile` exists with basic tasks (test, install)
5. `README.md` exists with project description and installation instructions
6. RSpec is configured with `spec/spec_helper.rb`
7. RuboCop is configured with project standards
8. Bundle install completes successfully
9. `rake spec` runs (even with no tests yet)
10. Repository has initial commit with working structure

## Tasks / Subtasks

- [ ] **Task 1: Initialize Git Repository and .gitignore** (AC: 1)
  - [ ] Initialize git repository with `git init`
  - [ ] Create `.gitignore` file with Ruby-specific patterns (coverage/, vendor/bundle/, .bundle/, *.gem, Gemfile.lock for libraries)
  - [ ] Create initial `.ruby-version` file specifying 3.2.2
  - [ ] Verify git initialization with `git status`

- [ ] **Task 2: Create Project Directory Structure** (AC: 2)
  - [ ] Create `bin/` directory for executable
  - [ ] Create `lib/` directory for source code
  - [ ] Create `lib/pocket_knife/` nested directory for module files
  - [ ] Create `spec/` directory for tests
  - [ ] Create `spec/unit/` directory for unit tests
  - [ ] Create `spec/integration/` directory for integration tests
  - [ ] Create `spec/e2e/` directory for end-to-end tests
  - [ ] Create `docs/` directory (if not exists)
  - [ ] Verify directory structure matches architecture source tree

- [ ] **Task 3: Create Gemfile with Dependencies** (AC: 3, 8)
  - [ ] Create `Gemfile` with Ruby version constraint (>= 3.2.0)
  - [ ] Add development group with rspec (~> 3.12)
  - [ ] Add development group with simplecov (~> 0.22)
  - [ ] Add development group with rubocop (~> 1.57)
  - [ ] Add development group with rake (~> 13.0)
  - [ ] Run `bundle install` and verify success
  - [ ] Verify `Gemfile.lock` is created

- [ ] **Task 4: Create Rakefile with Tasks** (AC: 4)
  - [ ] Create `Rakefile` in project root
  - [ ] Add RSpec task configuration (`RSpec::Core::RakeTask.new(:spec)`)
  - [ ] Add RuboCop task configuration (`RuboCop::RakeTask.new`)
  - [ ] Add custom `install` task that copies `bin/pocket-knife` to `~/bin/`
  - [ ] Add `test` task that runs both `:spec` and `:rubocop`
  - [ ] Set `default` task to `:test`
  - [ ] Verify `rake -T` lists all tasks

- [ ] **Task 5: Configure RSpec** (AC: 6, 9)
  - [ ] Create `spec/spec_helper.rb` file
  - [ ] Add SimpleCov configuration with 90% minimum coverage
  - [ ] Add SimpleCov filters for `/spec/` and `/vendor/`
  - [ ] Add SimpleCov groups: CLI, Calculator, Models
  - [ ] Configure SimpleCov to refuse coverage drop
  - [ ] Add `require 'pocket_knife'` at end of spec_helper
  - [ ] Create `.rspec` file with `--require spec_helper` and `--color` options
  - [ ] Run `rake spec` and verify it executes (even with 0 tests)

- [ ] **Task 6: Configure RuboCop** (AC: 7)
  - [ ] Create `.rubocop.yml` file
  - [ ] Set `AllCops` with `NewCops: enable` and `TargetRubyVersion: 3.2`
  - [ ] Disable `Style/Documentation` (small project exception)
  - [ ] Set `Metrics/MethodLength` max to 20
  - [ ] Set `Metrics/ClassLength` max to 150
  - [ ] Enable `Security/Eval` and `Security/Open` cops
  - [ ] Run `rubocop` and verify configuration loads

- [ ] **Task 7: Create README.md** (AC: 5)
  - [ ] Create `README.md` in project root
  - [ ] Add project title and description (Pocket Knife - CLI percentage calculator)
  - [ ] Add prerequisites section (Ruby 3.2+, Bundler)
  - [ ] Add installation instructions (clone, bundle install, rake install)
  - [ ] Add usage examples (`pocket-knife calc --percent 15 --of 200`)
  - [ ] Add development section (running tests with `rake spec`)
  - [ ] Add license information (MIT)

- [ ] **Task 8: Create Main Module Loader** (AC: 2)
  - [ ] Create `lib/pocket_knife.rb` file
  - [ ] Define `PocketKnife` module
  - [ ] Add version constant placeholder (`VERSION = '0.1.0'`)
  - [ ] Add require statements for future submodules (commented for now)
  - [ ] Verify file can be required without errors

- [ ] **Task 9: Create Initial Commit** (AC: 10)
  - [ ] Stage all created files with `git add`
  - [ ] Create initial commit with message "Initial project setup"
  - [ ] Verify commit with `git log`
  - [ ] Tag commit as v0.1.0-setup

- [ ] **Task 10: Validation and Final Checks**
  - [ ] Run `bundle exec rake spec` and verify it executes
  - [ ] Run `bundle exec rubocop` and verify no offenses
  - [ ] Verify directory structure matches architecture
  - [ ] Verify all acceptance criteria are met
  - [ ] Write unit tests for any configuration code if applicable

## Dev Notes

### Previous Story Insights

This is the first story (1.1) in the project - no previous story exists.

### Project Structure

[Source: architecture.md#7-source-tree]

**Required Directory Structure:**
```
pocket-knife/
├── bin/
│   └── pocket-knife              # Executable entry point (chmod +x)
├── lib/
│   └── pocket_knife/
│       ├── calculator.rb          # Business logic (future)
│       ├── calculation_request.rb # Input data model (future)
│       ├── calculation_result.rb  # Output data model (future)
│       ├── cli.rb                 # CLI parsing (future)
│       ├── errors.rb              # Custom exceptions (future)
│       └── version.rb             # Version constant (future)
│   └── pocket_knife.rb            # Main module loader
├── spec/
│   ├── spec_helper.rb             # RSpec configuration
│   ├── unit/                      # Unit tests
│   ├── integration/               # Integration tests
│   └── e2e/                       # End-to-end tests
├── .rubocop.yml                   # RuboCop linting configuration
├── .ruby-version                  # Ruby version specification (3.2.2)
├── Gemfile                        # Dependency management
├── Gemfile.lock                   # Locked dependency versions (generated)
├── Rakefile                       # Build and install tasks
├── README.md                      # User documentation
└── docs/                          # Project documentation (exists)
```

**Naming Conventions:**
- Snake case for files: `calculation_request.rb`, `calculator_spec.rb`
- Spec suffix for test files: `_spec.rb`
- Pascal case for classes/modules: `PocketKnife`, `Calculator`
- Constants in screaming snake case: `VERSION`

### Technology Stack

[Source: architecture.md#3-technology-stack]

**Core Dependencies:**
- **Ruby:** 3.2+ (minimum 3.2.0, recommend 3.2.2+)
- **Testing:** RSpec 3.12+ (dev/test only)
- **Code Coverage:** SimpleCov 0.22+ (dev/test only)
- **Linting:** RuboCop 1.57+ (dev/test only)
- **Build Tool:** Rake 13.0+ (dev/test only)
- **Runtime:** ZERO external dependencies (OptionParser is stdlib)

**Gemfile Template:**
```ruby
# frozen_string_literal: true

source 'https://rubygems.org'

ruby '>= 3.2.0'

group :development, :test do
  gem 'rspec', '~> 3.12'
  gem 'simplecov', '~> 0.22'
  gem 'rubocop', '~> 1.57'
  gem 'rake', '~> 13.0'
end
```

### Rake Tasks Configuration

[Source: architecture.md#8.3-rake-tasks]

**Rakefile Template:**
```ruby
# frozen_string_literal: true

require 'bundler/gem_tasks'
require 'rspec/core/rake_task'
require 'rubocop/rake_task'

RSpec::Core::RakeTask.new(:spec)
RuboCop::RakeTask.new

desc 'Install pocket-knife locally'
task :install do
  sh 'mkdir -p ~/bin'
  sh 'cp bin/pocket-knife ~/bin/pocket-knife'
  sh 'chmod +x ~/bin/pocket-knife'
  puts 'Installed to ~/bin/pocket-knife'
  puts 'Ensure ~/bin is in your PATH'
end

desc 'Run all tests'
task test: [:spec, :rubocop]

task default: :test
```

### RuboCop Configuration

[Source: architecture.md#10.2-ruby-style-guidelines]

**.rubocop.yml Template:**
```yaml
AllCops:
  NewCops: enable
  TargetRubyVersion: 3.2

Style/Documentation:
  Enabled: false # Allow missing class docs for small project

Metrics/MethodLength:
  Max: 20 # Keep methods focused

Metrics/ClassLength:
  Max: 150 # CLI class may approach this limit

Security/Eval:
  Enabled: true # Never use eval

Security/Open:
  Enabled: true # Prevent shell injection
```

### Git Ignore Patterns

**Required .gitignore entries for Ruby projects:**
```
# Coverage reports
coverage/

# Bundler
vendor/bundle/
.bundle/

# RubyGems
*.gem

# Logs
*.log

# OS files
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
```

### Coding Standards

[Source: architecture.md#10-coding-standards]

**Critical Rules for All Development:**
1. No metaprogramming - explicit method definitions only
2. Explicit over clever - clear, multi-step code preferred
3. Single Responsibility - one purpose per method/class
4. Fail-fast validation - validate inputs early
5. No global state - no class variables or globals
6. Explicit dependencies - minimal requires from stdlib only
7. Informative error messages - user-friendly, not technical jargon

### Testing

[Source: architecture.md#11-test-strategy-and-standards]

**Testing Philosophy:**
- **Approach:** Test-Driven Development (write tests before implementation)
- **Coverage Goals:** Minimum 90% line coverage (enforced by SimpleCov)
- **Test Pyramid:** 70% unit tests, 20% integration tests, 10% E2E tests

**SimpleCov Configuration (spec/spec_helper.rb):**
```ruby
require 'simplecov'

SimpleCov.start do
  add_filter '/spec/'
  add_filter '/vendor/'
  
  add_group 'CLI', 'lib/pocket_knife/cli.rb'
  add_group 'Calculator', 'lib/pocket_knife/calculator.rb'
  add_group 'Models', 'lib/pocket_knife/calculation_*'
  
  minimum_coverage 90
  refuse_coverage_drop
end

require 'pocket_knife'
```

**RSpec Configuration (.rspec):**
```
--require spec_helper
--color
--format documentation
```

**Test Organization:**
- `spec/unit/` - Test individual classes/methods in isolation
- `spec/integration/` - Test interaction between CLI and Calculator
- `spec/e2e/` - Test executable binary with real CLI arguments

**For This Story:**
- No functional code yet, so no unit tests needed
- Configuration files should be validated by running `rake spec` and `rubocop`
- Verify Rakefile tasks execute correctly

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-04 | 0.1 | Initial story draft | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
